---
name: personal:expense-receipt
description: AI 订阅报销收据识别与统计。识别目录下的 PDF/PNG 收据，提取人员、产品、金额、日期，自动去重，支持多币种（USD、TRY），输出明细表和按人汇总，并将结果写入收据目录。触发词：报销统计、收据识别、统计报销、AI 订阅费用
metadata:
  version: "1.0.0"
---

# 报销收据识别与统计

识别指定目录下的 AI 订阅收据，提取金额并汇总统计，支持多币种自动转换。

## 参数

| 参数 | 必填 | 说明 |
|------|------|------|
| 目录路径 | 是 | 包含收据文件的目录 |
| 汇率 | 否 | USD/CNY 汇率，未提供则自动获取 |

示例：
- `报销统计 /path/to/receipts`
- `报销统计 /path/to/receipts 汇率 7.04`

## 支持的币种

| 币种 | 符号 | 格式 |
|------|------|------|
| 美元 USD | $ | $20.00 |
| 土耳其里拉 TRY | ₺ | ₺499,99（逗号是小数点） |

## 工作流程

### 1. 获取汇率

优先使用用户指定汇率，否则运行脚本自动获取：

```bash
python3 scripts/get_exchange_rates.py
```

### 2. 读取收据文件

- 列出目录下所有 `.pdf` 和 `.png` 文件
- 使用 Read 工具逐个读取
- 支持：Cursor、Claude、ChatGPT、Windsurf、OpenRouter、Trae、Apple 等

### 3. 识别字段

| 字段 | 来源 |
|------|------|
| 人员 | Customer Name / Bill to |
| 产品 | 订阅产品名称 |
| 金额 | 原始金额和币种 |
| 日期 | Receipt Date / Date paid |

### 4. 去重规则

同一人员 + 同一日期 + 同一金额 = 同一笔交易（Invoice 和 Receipt 只计一次）

### 5. 输出格式

#### 收据明细

```markdown
## 收据明细

| 文件 | 人员 | 产品 | 金额 | RMB | 日期 |
|------|------|------|------|-----|------|
| yyy.pdf | 李四 | ChatGPT Plus | ₺499.99 | ¥80.00 | 2025-11-09 |
| zzz.pdf | 王五 | Cursor Pro | $20.00 | ¥139.14 | 2025-11-22 |
```

#### 按人汇总

```markdown
## 按人汇总

| 人员 | 原始金额 | RMB |
|------|----------|-----|
| 张三 | $40.00 | ¥281.60 |
| 李四 | $100.00 + ₺1,499.97 | ¥944.00 |
```

#### 汇总

```markdown
## 汇总

| 币种 | 金额 | RMB |
|------|------|-----|
| USD | $296.19 | ¥2,060.60 |
| TRY | ₺499.99 | ¥80.00 |

**总计：¥2,140.60 RMB（6人）**
```

### 6. 写入统计文件

将统计结果以 markdown 格式写入收据目录：

- 文件名格式：`{年}年{月}月AI订阅报销统计.md`
- 示例：`2026年1月AI订阅报销统计.md`
- 位置：与收据文件同目录

## 注意事项

- 金额保留 2 位小数
- 土耳其里拉：₺499,99 = 499.99（逗号是小数点）
- 汇率获取失败时使用默认值：USD=6.957, TRY=0.160
- 无法识别的收据标注"无法识别"
- 统计完成后自动将结果写入收据目录
